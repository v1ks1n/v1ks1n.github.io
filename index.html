<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Money Catcher</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes">

    <link rel="shortcut icon" type="image/png" href="./favicon.png">
    <script src="./Money Catcher.js"></script>

    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #000000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #game-container {
            position: relative;
            width: 100%;
            height: 100%;
            max-width: 100%;
            max-height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #openfl-content {
            position: absolute;
            transform-origin: center center;
            background: #000000;
        }

        #loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
            color: white;
            font-family: Arial, sans-serif;
        }
    </style>
</head>
<body>
    <noscript>This webpage makes extensive use of JavaScript. Please enable JavaScript in your web browser to view this page.</noscript>

    <div id="game-container">
        <div id="loading-overlay">
            <div id="progress">Loading game...</div>
        </div>
        <div id="openfl-content"></div>
    </div>

    <script>
        // Предотвращаем скроллинг при касании
        window.addEventListener("touchmove", function (event) {
            event.preventDefault();
        }, { capture: false, passive: false });

        // Обработка высокого DPI
        if (typeof window.devicePixelRatio != 'undefined' && window.devicePixelRatio > 2) {
            var meta = document.querySelector("meta[name=viewport]");
            meta.setAttribute('content', 'width=device-width, initial-scale=' + (2 / window.devicePixelRatio) + ', user-scalable=no');
        }

        // Функция для расчета и применения масштаба
        function resizeGame() {
            var container = document.getElementById('game-container');
            var game = document.getElementById('openfl-content');
            var loading = document.getElementById('loading-overlay');

            if (!game || !container) return;

            // Размеры окна браузера
            var windowWidth = window.innerWidth;
            var windowHeight = window.innerHeight;

            // Исходные размеры игры
            var gameWidth = 1280;
            var gameHeight = 704;

            // Рассчитываем соотношения сторон
            var windowRatio = windowWidth / windowHeight;
            var gameRatio = gameWidth / gameHeight;

            var scale, newWidth, newHeight;

            // Определяем, как масштабировать игру
            if (windowRatio > gameRatio) {
                // Окно шире, чем игра - масштабируем по высоте
                scale = windowHeight / gameHeight;
                newWidth = gameWidth * scale;
                newHeight = windowHeight;
            } else {
                // Окно уже или такое же соотношение - масштабируем по ширине
                scale = windowWidth / gameWidth;
                newWidth = windowWidth;
                newHeight = gameHeight * scale;
            }

            // Применяем масштаб к игровому контейнеру
            game.style.width = gameWidth + 'px';
            game.style.height = gameHeight + 'px';
            game.style.transform = 'scale(' + scale + ')';

            // Также масштабируем загрузочный экран
            if (loading) {
                loading.style.transform = 'scale(' + scale + ')';
            }

            console.log("Game scaled to: " + (scale * 100).toFixed(2) + "%");
        }

        // Инициализация игры после загрузки
        window.addEventListener('load', function () {
            // Сначала настраиваем размеры
            resizeGame();

            // Запускаем игру
            lime.embed("Money Catcher", "openfl-content", 1280, 704, {
                parameters: {}
            });

            // Скрываем загрузочный экран через небольшую задержку
            setTimeout(function () {
                var loading = document.getElementById('loading-overlay');
                if (loading) {
                    loading.style.display = 'none';
                }
            }, 1000);
        });

        // Обработчик изменения размера окна
        window.addEventListener('resize', resizeGame);
        window.addEventListener('orientationchange', function () {
            // Небольшая задержка для завершения изменения ориентации
            setTimeout(resizeGame, 100);
        });
    </script>
</body>
</html>
